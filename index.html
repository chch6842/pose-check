<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å§¿å‹¢æª¢æ¸¬</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    
    <style>
        body { margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; background-color: #333; color: white; font-family: sans-serif; }
        #status-bar { width: 100%; padding: 20px; text-align: center; font-size: 32px; font-weight: bold; background-color: #555; transition: background-color 0.3s; }
        .container { position: relative; width: 100%; max-width: 640px; margin-top: 20px; }
        /* éš±è—åŸå§‹å½±ç‰‡ï¼Œæˆ‘å€‘åªé¡¯ç¤ºç•«ä¸Šéª¨æ¶çš„ Canvas */
        video { display: none; }
        canvas { width: 100%; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

    <div id="status-bar">è«‹ç«™åœ¨é¡é ­å‰...</div>

    <div class="container">
        <video id="input_video" autoplay playsinline></video>
        <canvas id="output_canvas" width="640" height="480"></canvas>
    </div>

    <script>
        // å–å¾—ç¶²é å…ƒç´ 
        const videoElement = document.getElementById('input_video');
        const canvasElement = document.getElementById('output_canvas');
        const canvasCtx = canvasElement.getContext('2d');
        const statusBar = document.getElementById('status-bar');

        // ç•¶ MediaPipe è™•ç†å®Œæ¯ä¸€å¼µç•«é¢æ™‚ï¼ŒæœƒåŸ·è¡Œé€™å€‹å‡½å¼
        function onResults(results) {
            // 1. ç•«å‡ºèƒŒæ™¯ç•«é¢
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

            // 2. å¦‚æœæœ‰æŠ“åˆ°äººé«”éª¨æ¶
            if (results.poseLandmarks) {
                // ç•«å‡ºéª¨æ¶ç·šæ¢
                window.drawConnectors(canvasCtx, results.poseLandmarks, POSE_CONNECTIONS, {color: '#00FF00', lineWidth: 4});
                window.drawLandmarks(canvasCtx, results.poseLandmarks, {color: '#FF0000', lineWidth: 2});

                // 3. æŠ“å–é—œéµé»çš„ Y åº§æ¨™ (0 æ˜¯é ­é ‚ï¼Œ1 æ˜¯è…³åº•)
                const leftShoulder = results.poseLandmarks[11].y;
                const rightShoulder = results.poseLandmarks[12].y;
                const leftElbow = results.poseLandmarks[13].y;
                const rightElbow = results.poseLandmarks[14].y;

                // 4. åˆ¤æ–·é‚è¼¯ï¼šåªè¦æœ‰ä¸€éš»æ‰‹çš„æ‰‹è‚˜ï¼Œé«˜æ–¼åŒå´çš„è‚©è†€ (Yå€¼è¼ƒå°)ï¼Œå°±ç®—èˆ‰æ‰‹
                if (leftElbow < leftShoulder || rightElbow < rightShoulder) {
                    statusBar.innerText = "ğŸ™Œ å‹•ä½œé”æ¨™ (Hands Up)!";
                    statusBar.style.backgroundColor = "#28a745"; // ç¶ è‰²
                } else {
                    statusBar.innerText = "è«‹èˆ‰èµ·æ‰‹...";
                    statusBar.style.backgroundColor = "#555"; // ç°è‰²
                }
            }
            canvasCtx.restore();
        }

        // åˆå§‹åŒ– MediaPipe Pose æ¨¡å‹
        const pose = new Pose({locateFile: (file) => {
            return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;
        }});
        pose.setOptions({
            modelComplexity: 1,
            smoothLandmarks: true,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });
        pose.onResults(onResults);

        // å•Ÿå‹•æ”å½±æ©Ÿä¸¦å‚³å…¥ç•«é¢
        const camera = new Camera(videoElement, {
            onFrame: async () => {
                await pose.send({image: videoElement});
            },
            width: 640,
            height: 480
        });
        camera.start();
    </script>
</body>
</html>