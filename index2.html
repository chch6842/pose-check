<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curves AI å§¿å‹¢çŸ¯æ­£ - æ“´èƒ¸è½‰é«”</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    
    <style>
        body { margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; background-color: #2c3e50; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #status-bar { width: 100%; padding: 25px; text-align: center; font-size: 28px; font-weight: bold; background-color: #34495e; transition: all 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .container { position: relative; width: 95%; max-width: 720px; margin-top: 20px; }
        video { display: none; }
        canvas { width: 100%; border-radius: 15px; border: 4px solid #7f8c8d; }
        .info-panel { margin-top: 15px; font-size: 18px; background: rgba(0,0,0,0.5); padding: 10px 20px; border-radius: 20px; }
    </style>
</head>
<body>

    <div id="status-bar">æº–å‚™é–‹å§‹æ“´èƒ¸è½‰é«”...</div>
    
    <div class="info-panel">
        ç•¶å‰æ—‹è½‰è§’åº¦: <span id="angle-display">0</span>Â°
    </div>

    <div class="container">
        <video id="input_video" autoplay playsinline></video>
        <canvas id="output_canvas" width="640" height="480"></canvas>
    </div>

    <script>
        const videoElement = document.getElementById('input_video');
        const canvasElement = document.getElementById('output_canvas');
        const canvasCtx = canvasElement.getContext('2d');
        const statusBar = document.getElementById('status-bar');
        const angleDisplay = document.getElementById('angle-display');

        // è¨­å®šè­¦å‘Šé–¾å€¼ï¼ˆä¾‹å¦‚ï¼šå»ºè­°è½‰é«”ä¸è¦è¶…é 50 åº¦ï¼‰
        const MAX_RECOMMENDED_ANGLE = 50;

        function onResults(results) {
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

            if (results.poseLandmarks) {
                // 1. ç•«å‡ºéª¨æ¶
                window.drawConnectors(canvasCtx, results.poseLandmarks, POSE_CONNECTIONS, {color: '#ecf0f1', lineWidth: 2});
                window.drawLandmarks(canvasCtx, [results.poseLandmarks[11], results.poseLandmarks[12]], {color: '#e74c3c', lineWidth: 4});

                // 2. æŠ“å–è‚©è†€åº§æ¨™ (11: å·¦è‚©, 12: å³è‚©)
                const leftS = results.poseLandmarks[11];
                const rightS = results.poseLandmarks[12];

                // 3. è¨ˆç®— Z è»¸æ·±åº¦ç”¢ç”Ÿçš„è§’åº¦ (EEäººçš„ä¸‰è§’å‡½æ•¸å¾©å¥)
                // æˆ‘å€‘çœ‹è‚©è†€åœ¨ X-Z å¹³é¢çš„æ—‹è½‰
                let angleRad = Math.atan2(leftS.z - rightS.z, leftS.x - rightS.x);
                let angleDeg = Math.abs(angleRad * (180 / Math.PI));
                
                // æ­¸ä¸€åŒ–ï¼šè®“æ­£é¢æœå‘æ™‚ç‚º 0 é™„è¿‘
                let rotation = Math.abs(angleDeg - 0); 
                angleDisplay.innerText = rotation.toFixed(1);

                // 4. åˆ¤æ–·é‚è¼¯
                if (rotation > MAX_RECOMMENDED_ANGLE) {
                    statusBar.innerText = "âš ï¸ è­¦å‘Šï¼šè½‰å‹•è§’åº¦éå¤§ï¼";
                    statusBar.style.backgroundColor = "#e74c3c"; // è­¦å‘Šç´…
                    statusBar.style.transform = "scale(1.05)";
                } else if (rotation > 15) {
                    statusBar.innerText = "ğŸ‘ è‰¯å¥½è½‰é«”ä¸­";
                    statusBar.style.backgroundColor = "#9b59b6"; // Curves ç´«
                    statusBar.style.transform = "scale(1)";
                } else {
                    statusBar.innerText = "è«‹é–‹å§‹å‘å·¦æˆ–å‘å³è½‰é«”";
                    statusBar.style.backgroundColor = "#34495e";
                    statusBar.style.transform = "scale(1)";
                }
            }
            canvasCtx.restore();
        }

        const pose = new Pose({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`});
        pose.setOptions({ modelComplexity: 1, smoothLandmarks: true, minDetectionConfidence: 0.5, minTrackingConfidence: 0.5 });
        pose.onResults(onResults);

        const camera = new Camera(videoElement, {
            onFrame: async () => { await pose.send({image: videoElement}); },
            width: 640, height: 480
        });
        camera.start();
    </script>
</body>
</html>